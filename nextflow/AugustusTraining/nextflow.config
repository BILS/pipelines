manifest {
  name = 'Augustus Training'
  author = 'Mahesh Binzer-Panchal'
  homePage = ''
  description = 'Nextflow Augustus training pipeline'
  mainScript = 'AugustusTraining.nf'
  nextflowVersion = '>=0.32.0'
  version = '0.1'
}

profiles {

  conda {
    process {
      conda = "$baseDir/environment.yml"
      withLabel: 'GAAS' {
        conda = "$baseDir/gaas_environment.yml"
      }
    }
  }

  debug { process.beforeScript = 'echo $HOSTNAME' }
  docker { docker.enabled = true }
  singularity { singularity.enabled = true }
  test { includeConfig 'conf/test.config' }

  nbis {
    executor {
      name = 'slurm'
    }
    process {
      cpus = 1
      maxForks = 20
      scratch = true
      stageOutMode = 'rsync'
      // withName: split_maker_evidence {
      // }
      // withName: model_selection_by_AED {
      // }
      // withName: retain_longest_isoform {
      // }
      // withName: remove_incomplete_gene_models {
      // }
      // withName: filter_by_locus_distance {
      // }
      // withName: gff2protein {
      // }
      // withName: blast_makeblastdb {
      // }
      withName: blast_recursive {
        cpus = 8
      }
      // withName: gff_filter_by_blast {
      // }
      // withName: gff2gbk {
      // }
      // withName: gbk2augustus {
      // }
    }
  }
}

params {

  // Pipeline Options
  outdir = './results'
  tracedir = "${params.outdir}/pipeline_info"
}

process.container = 'augustus-training:1.0'
process.shell = ['/bin/bash', '-euo', 'pipefail']

timeline {
  enabled = true
  file = "${params.tracedir}/execution_timeline.html"
}

report {
  enabled = true
  file = "${params.tracedir}/execution_report.html"
}

trace {
  enabled = true
  file = "${params.tracedir}/execution_trace.txt"
}

dag {
  enabled = true
  file = "${params.tracedir}/pipeline_dag.svg"
}
