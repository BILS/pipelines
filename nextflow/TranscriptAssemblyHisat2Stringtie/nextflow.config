manifest {
  name = 'TranscriptAssemblyHisat2Stringtie'
  author = 'Mahesh Binzer-Panchal'
  homePage = ''
  description = 'Nextflow Transcript assembly pipeline, using Hisat2 and Stringtie'
  mainScript = 'TranscriptAssemblyHisat2Stringtie.nf'
  nextflowVersion = '>=0.32.0'
  version = '0.1'
}

profiles {
  conda { process.conda = "$baseDir/environment.yml" }
  debug { process.beforeScript = 'env' }
  docker { docker.enabled = true }
  singularity { singularity.enabled = true }
  test { includeConfig 'conf/test.config' }

  nbis {
    executor {
      name = 'slurm'
    }
    process {
      cpus = 1
      maxForks = 20
      scratch = true
      stageOutMode = 'rsync'
      withName: fastqc {
        cpus = 2
      }
      withName: trimmomatic {
        cpus = 2
      }
      withName: hisat2_index {
        cpus = 4
      }
      withName: hisat2 {
        cpus = 8
      }
      withName: stringtie {
        cpus = 8
      }
      // withName: multiqc {
      // }
    }
  }

  bils {
    executor {
      name = 'lsf'
    }
    process {
      cpus = 1
      maxForks = 20
      scratch = true
      stageOutMode = 'rsync'
      withName: fastqc {
        cpus = 2
      }
      withName: trimmomatic {
        cpus = 2
      }
      withName: hisat2_index {
        cpus = 4
      }
      withName: hisat2 {
        cpus = 8
      }
      withName: stringtie {
        cpus = 8
      }
      // withName: multiqc {
      // }
    }
  }
}

resume = true

process.container = 'transcript-assembly-hisat2-stringtie:1.0'
process.shell = ['/bin/bash', '-euo', 'pipefail']

timeline {
  enabled = true
  file = "pipeline_report/execution_timeline.html"
}

report {
  enabled = true
  file = "pipeline_report/execution_report.html"
}

trace {
  enabled = true
  file = "pipeline_report/execution_trace.txt"
}

dag {
  enabled = true
  file = "pipeline_report/pipeline_dag.svg"
}
