/*
 * -------------------------------------------------
 * Nextflow config file for NBIS annotation service
 * -------------------------------------------------
 * Configuration for testing workflows locally on
 * on the NBIS annotation server
 * -------------------------------------------------
 */

env {
  NXF_WORK="/scratch"
}

params {
  
  containerPath = '/tmp/'
  singleCPUMem  = 8.GB
  totalMemory = 104.GB // change to 240 on irma

}

docker {
  enabled = true
  fixOwnership = true
  runOptions = "-u \$(id -u):\$(id -g)"
}

executor {
  name = 'local'
  cpus = 4
}

process {

  // Default process resources
 // A process may use one core,
  cpus = 1
  // 8 GB of memory,
  memory = {params.singleCPUMem}

  // and 16 of them are allowed to be launched simultaneously.
  maxForks = 16

  errorStrategy = {task.exitStatus == 143 ? 'retry' : 'terminate'}
  maxErrors = '-1'
  maxRetries = 3

  // These processes are defined in main.nf

  withName:ConcatVCF {
    cpus = 8
  }
  withName:CreateRecalibrationTable {
    cpus = 16
    memory = {params.totalMemory}
  }
  withName:RunMultiQC {
  }
}
